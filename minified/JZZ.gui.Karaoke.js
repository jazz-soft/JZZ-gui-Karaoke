!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e:"function"==typeof define&&define.amd?define("JZZ.gui.Karaoke",["JZZ","JZZ.midi.SMF"],e):e(JZZ)}(0,function(a){function n(t){var e=new a.Widget;for(var i in n.prototype)n.prototype.hasOwnProperty(i)&&(e[i]=n.prototype[i]);if(e.spans=[],e.current=0,e.div=document.createElement("div"),e.div.className="karaoke","string"==typeof t)try{return document.getElementById(t).appendChild(e.div),e}catch(t){}try{return t.appendChild(e.div),e}catch(t){}return document.body.appendChild(e.div),e}a.gui||(a.gui={}),a.gui.Karaoke||(n.prototype.load=function(t){for(var e,i,n,r,d,o,s;this.div.firstChild;)this.div.removeChild(this.div.firstChild);for(this.spans=[],e=this.current=0;e<t.length;e++)if(t[e]instanceof a.MIDI.SMF.MTrk)for(d=void 0,i=0;i<t[e].length;i++)if(1==t[e][i].ff){if("@"==(n=a.lib.fromUTF8(t[e][i].dd))[0]){o=document.createElement("div"),(r={K:"k",V:"v",I:"i",L:"l",T:"t",W:"w"}[n[1]])&&(n=n.substring(2),o.className=r),o.appendChild(document.createTextNode(n)),this.div.appendChild(o),d=void 0;continue}"\\"==n[0]?(n=n.substring(1),d=void 0):"/"==n[0]&&(n=n.substring(1),o=void 0),d||(d=document.createElement("p"),this.div.appendChild(d),o=void 0),o||(o=document.createElement("div"),d.appendChild(o)),(s=document.createElement("span")).appendChild(document.createTextNode(n)),o.appendChild(s),this.spans.push([t[e][i].tt,s])}this.spans.sort(function(t,e){return t[0]-e[0]})},n.prototype.reset=function(){for(var t=0;t<this.spans.length;t++)this.spans[t][1].className="";this.current=0},n.prototype._receive=function(t){if(void 0!==t.tt)for(;this.current<this.spans.length&&!(t.tt<this.spans[this.current][0]);this.current++)this.spans[this.current][1].className="hi"},a.gui.Karaoke=n)});